## Github OIDC Review for Seif


- Name: Oh sorry for not catching this earlier cause it might be 'too late' in some sense cause its published, but this is `Github` specific not really just `git`, so I might expect it to be named `github-oidc`. It wouldn't work with any hosted git provider, like Gitlab for example
- I noticed that the 'old' repo under your account still exists and isn't 'archived'. I might recommend adding a not in the readme directing people to the `the-cafe` version and then archiving the repo!
	- Another thing just to know for the future, is that its possible to transfer a repo to an org! That way Github will auto redirect links from your personal one to the org version and stuff like that. More important for projects that have 'lived' in one org for awhile before you transfer but good to know either way!
	- Oh but the 'old' repo is the service not the extraction! That makes sense and probably means the transfer wouldn't make as much sense but now you know about it for the future either way lol
- Add a small sentence description in Github sidebar area! It shows in the card previews so makes the project look more complete that way!
- No Github Actions! I'd recommend adding some github actions to do Continuous Integration (testing on each PR lol). Feel free to steal the basic action file from any of my rust projects. In addition to being good practice its a relatively easy thing to do and is _great_ signal for people looking at the repo! A library without any CI is a signal that I might want to look elsewhere :laughing:
	- I'd turn that on to run `cargo clippy` for each PR at a minimum to help make sure you catch any little errors that the compiler will spit at ya
	- I'd _also_ have it run `cargo test` and ideally write some tests, but I like setting up the Action no matter what, so that if/when tests are written they get run automatically
	- One thing that would be _really cool_ to include in an action is running Cargo Semver Checks: https://github.com/obi1kenobi/cargo-semver-checks
		- This is a tool to make sure that in each release that you make you uphold the "semver guarantees" of each version release! Too much to explain in a quick note :lol: but Predrag (the author, who I internet know and chat with in Discords lol) has a great blog with info. This is a decent overview kinda article that explains the problem and a study they did about how many of the top crates accidentally release versions that 'break' semver: https://predr.ag/blog/semver-in-rust-tooling-breakage-and-edge-cases/
		- I love the idea of this but haven't set it up myself since I don't have any libraries crates that I've published to crates.io, so don't have an action to follow but can/would love to help set this up!
- In the "Use Case" Section
	- I like the Railway example! Doesn't look like they provide an OIDC so makes a perfect example! If you wanted to you could say something like "Make your service provider as easy to integrate as the big players" or something like that. Cause AWS and the like all support this already, so if you want to play in the "big leagues" its good to have
	- The other examples don't really feel like "use cases" to me? They are more steps to take to use the library? Maybe they can be moved or rephrased a bit and put into a different section?
- Usage Examples
	- There are great love it!
	- **Edit: Actually don't do this quite yet... I like the idea but I think we want to flesh out the use case before we invest time into this!** 
	- One thing they made me think of, is that it would be really cool to have a re-usable Github action that people could just use in their workflow without having to copy paste the full example code!
		- I think that would mean making a new repo, maybe like `the-cafe/oidc-github-action` or whatever! https://docs.github.com/en/actions/sharing-automations/creating-actions/publishing-actions-in-github-marketplace
		- That could literally basically just wrap up the example :laughing:
		- I was thinking as an input it could maybe take the URL you want to send the OIDC token to?
			- Hmm not sure how useful this actually would be on a second thought lol lets leave it off for now, your example in the readme is perfect! But lets keep it mind cause it def could be cool!
- Ahh a License file!
	- You marked it as MIT or Apache 2 in the Cargo.toml which is perfect! So I'd add a LICENSE file with either one of those licenses. I'm moving towards Apache 2 in general but either is a totally fine choice! You could even put both and do a `LICENSE_mit` and `LICENSE_apache2` files or something :shrug: Up to you!
		- Github might be able to help you fill this in but not sure for existing repos, but easy to copy paste one in
- Docs.rs page
	- Add a link to the docs.rs/git-oidc page to the Readme
	- Love that you have some docs written for the two functions!
	- I'd add some docs to the GithubClaims struct too! In general I think its good to add docs to all of the public things that are exported by the crate!
- Code Level Thoughts!
	- As a User of the crate I do NOT want to have to know the `https://token.actions.githubusercontent.com` url to fetch tokens from lol
		- Its definitely not crazy to have a more 'general purpose' function that can fetch the JWKs from anywhere, but since the point of this crate is to make it stupid simple to integrate Github OIDC I might at least make a `fetch_github_jwks` that uses that URL so that devs don't have to remember it themselves!
	- I don't love the return value of `fetch_gtihub_jwks` (or `fetch_jwks`) being a `Value` json object. Its harder to use and consume a Value as opposed to a struct with known fields.
		- I think what I'd really expect these functions to return is a `GithubJWKs` custom struct! This can hold a `Vec<JWKs>` or something inside it but gives you a nice named wrapper thats easier to work with than the Value!
	- Once you have a `GithubJWKs` struct we can move the `validate_github_token` function to be a method of the struct instead of a 'free floating function'!
		- This would just make it slightly easier to consume! Its really silly honestly but doing `github_jwks.validate_token(some_token)` just _feels_ a bit better than `validate_github_token(github_jwks, some_token)`
	- Error Handling!
		- This might be my "biggest" comment here lol
		- You are using eyre for the error handling and returning their `Result` type, which is _great_ for applications! Buttt we are making a library now! So the 'rules' are different :laughing: And honestly the why deserves a whole blog post! This one looks decent: https://nick.groenen.me/posts/rust-error-handling/#libraries-versus-applications
			- Anywhere that blog says `anyhow` just internally replace it with `eyre` lol Eyre is a 'next version' of anyhow basically!
		- The TLDR version is:
			- In an application you usually don't care about the specifics of an error in the 'middle' of your code. When an error happens you mostly just want to bubble it all the way up the application to some error handler at the top that can report it to an error tool (like Sentry) or log out to the CLI and/or exit the program. That sort of thing!
			- But in a library you don't want to make that kind of decision for your users! Who knows what they want to do on errors, and we want to be as specific as possible as to what went wrong! So ideally each function that can error returns a custom enum that implements Error, and has an enum variant for EACH way the function can fail. For the fetching that might include one for any Network related error, and then maybe one for the JSON response not being the 'shape' you expect and stuff like that! And for the validating it might be even more useful! You can have an error enum with variants for each _reason_ the verification failed! Like one for the not finding the JWK the token was signed with, and one for it matching verifying, etc etc. This was a user of the library can react to each error differently if they want to!
	- GithubClaims struct
		- It doesn't look like any of the attributes on this struct are public, and there are no public functions either! This means that a consumer of this crate can't really check of the claims at all :sadnerd:
			- You could see this by trying to use this crate in your `oidc_service` repo! You won't be able to actually see anything from inside the GithubClaims which probably makes it less useful as a library!
			- The 'easy' and likely correct for this usecase answer is to just make all the fields public, so others can access them!
				- Alternatively could keep them private and add some functions that let people access the specific data you want. That way you can keep the internals private (so you can change them later) and just have people rely on the functions you specifically write!
